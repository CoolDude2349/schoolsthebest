<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Load It</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden; 
        }
    </style>
</head>
<body>

    <script>
        const rawGitHubURL = "/schoolsthebest/g/eagler1.5.html"; 

        // Function to check if service worker is enabled
        function isServiceWorkerEnabled() {
            return 'serviceWorker' in navigator && navigator.serviceWorker.controller;
        }

        // Function to cache HTML content with JavaScript
        function cacheHTMLWithJS(key, htmlContent) {
            if (typeof(Storage) !== "undefined") {
                localStorage.setItem(key, htmlContent);
                console.log("HTML with JavaScript cached!");
            } else {
                console.log("localStorage is not supported.");
            }
        }

        // Function to open cached HTML in a new about:blank page
        function openCachedHTML() {
            const cachedHTML = localStorage.getItem('offlinePageWithJS');
            if (cachedHTML) {
                const doc = document;
                if (doc) {
                    doc.open();
                    doc.write(cachedHTML);
                    doc.close();
                } else {
                    alert("Popup blocked! Please allow popups for this site.");
                }
            } else {
                alert("No cached HTML found.");
            }
        }

        // Callback function to handle the fetched HTML
        function handleFetchedHTML(html) {
            const doc = document;
            doc.open();
            doc.write(html);  // Writing the fetched HTML to the document
            doc.close();

            // Cache the fetched HTML for later use
            cacheHTMLWithJS('offlinePageWithJS', html); // Store the fetched HTML in localStorage
            console.log("Fetched HTML content: ", html);
        }

        // Fetching HTML and passing the result to the callback
        fetch(rawGitHubURL)
            .then(response => response.text())
            .then(html => {
                handleFetchedHTML(html);  // Passing the fetched HTML to the callback
            })
            .catch(error => console.error("Error loading HTML:", error));

        // Check if the page is offline, no service worker is enabled, and if cached HTML is available
        window.onload = function() {
            if (!navigator.onLine && !isServiceWorkerEnabled() && localStorage.getItem('offlinePageWithJS')) {
                document.body.innerHTML = ""; // Clear existing content
                openCachedHTML(); // Open the cached HTML
            } else {
                console.log("Online, service worker is enabled, or no cached HTML available.");
            }
        }
    </script>

</body>
</html>
